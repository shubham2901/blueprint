---
phase: 01-shell-landing-figma-import
plan: 05
type: execute
wave: 3
depends_on:
  - 01-02
  - 01-03
  - 01-04
files_modified:
  - frontend/app/page.tsx
  - frontend/app/components/BuildLanding.tsx
  - frontend/app/components/PasteUrlView.tsx
  - frontend/app/components/ImportingView.tsx
  - frontend/lib/api.ts
autonomous: true
requirements:
  - FIGMA-01
  - FIGMA-02
  - FIGMA-03

must_haves:
  truths:
    - Connect CTA redirects to Figma OAuth; user returns to app
    - figmaConnected state reflects OAuth completion (from URL param or status endpoint)
    - Import button triggers POST /api/figma/import with credentials
    - Importing state shows loading skeleton (designs/screen-03)
    - Design context or error displayed after import
  artifacts:
    - path: frontend/lib/api.ts
      provides: figmaStatus, figmaImport fetch helpers
      contains: "figma"
  key_links:
    - from: frontend/app/components/BuildLanding.tsx
      to: backend /api/figma/oauth/start
      via: window.location or redirect
      pattern: "oauth/start|figma.*start"
    - from: frontend/app/components/PasteUrlView.tsx
      to: backend /api/figma/import
      via: fetch with credentials
      pattern: "figma/import|api.*import"
---

<objective>
Wire frontend to backend: Connect CTA → OAuth start, handle callback return, Import → POST import, show loading/result. figmaConnected from ?figma_connected=1 or GET /api/figma/status.

Purpose: Complete Phase 1 flow. User can connect, paste URL, import, and see design context.
Output: Working Connect + Import flow with loading/error states.
</objective>

<execution_context>
@/Users/shubham/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shubham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-shell-landing-figma-import/01-RESEARCH.md
@frontend/app/page.tsx
@frontend/app/components/BuildLanding.tsx
@frontend/app/components/PasteUrlView.tsx
@frontend/lib/api.ts
@designs/screen-03.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Connect CTA and OAuth return handling</name>
  <files>frontend/app/page.tsx, frontend/app/components/BuildLanding.tsx, frontend/lib/api.ts</files>
  <action>
    In api.ts: add getFigmaStatus() — GET backend API URL + /api/figma/status with credentials: 'include'. Returns { connected: boolean }. Add getBackendUrl() or use NEXT_PUBLIC_API_URL from env (ensure it points to backend, e.g. http://localhost:8000). Wire BuildLanding onConnectClick: redirect to backend + /api/figma/oauth/start (full URL). On page load (page.tsx): check searchParams for ?figma_connected=1 — set figmaConnected=true. Also on mount: call getFigmaStatus() to set figmaConnected (handles refresh). Pass figmaConnected to BuildLanding and PasteUrlView. If ?figma_error=1&error_code=BP-XXX: show toast or inline message with friendly text + (Ref: BP-XXX) per docs/ERROR_CODES.md.
  </action>
  <verify>Click Connect → redirects to Figma. Complete OAuth → return to / with figma_connected=1, figmaConnected=true. Refresh shows connected via status.</verify>
  <done>Connect CTA works. OAuth return handled. figmaConnected state correct.</done>
</task>

<task type="auto">
  <name>Task 2: Import wiring and importing state</name>
  <files>frontend/app/page.tsx, frontend/app/components/PasteUrlView.tsx, frontend/app/components/ImportingView.tsx, frontend/lib/api.ts</files>
  <action>
    In api.ts: add importFigmaFrame(url: string) — POST backend + /api/figma/import with { url }, credentials: 'include'. Returns design_context + warnings or throws. On PasteUrlView Import click: call importFigmaFrame, set importing=true. Show ImportingView (from designs/screen-03): URL input readonly, "Importing" button disabled with spinner, "Building your prototype..." or "Importing your frame...", skeleton loading area. On success: store design_context in state, show success (e.g. "Frame imported" or minimal preview placeholder — Phase 1 ends at design context returned). On error: show friendly message + (Ref: BP-XXXXXX). Use error_code from response. Handle 401: "Connect with Figma to import this frame." Handle 400: "That doesn't look like a valid Figma frame URL..." Handle 403/404/5xx: "We couldn't import that frame..." All per docs/ERROR_CODES.md.
  </action>
  <verify>Paste URL, click Import — see importing state. Success shows design context or confirmation. Error shows friendly message + ref. 401 prompts Connect.</verify>
  <done>Import flow complete. Loading state, success, and errors handled.</done>
</task>

</tasks>

<verification>
- Connect → OAuth → return → connected
- Import → loading → design context or error
- All errors show friendly message + (Ref: BP-XXXXXX)
- 401 prompts Connect
</verification>

<success_criteria>
- User completes Figma OAuth and returns to app
- User can paste URL and trigger import
- System returns design context for single frame
- Error handling per docs/ERROR_CODES.md
</success_criteria>

<output>
After completion, create `.planning/phases/01-shell-landing-figma-import/01-05-SUMMARY.md`
</output>
